# HiSpaR Package: Complete Skeleton Structure

## ğŸ“¦ Package Overview

**Status:** âœ… Skeleton Complete - Ready for C++ Integration

**Location:** `/Users/lyc/Proj/HiSpa/R-package/`

**Package Name:** HiSpaR

**Version:** 1.0.0

## ğŸ“ Directory Structure

```
R-package/
â”‚
â”œâ”€â”€ ğŸ“„ DESCRIPTION              Package metadata, dependencies
â”œâ”€â”€ ğŸ“„ NAMESPACE                Function exports (auto-generated)
â”œâ”€â”€ ğŸ“„ LICENSE                  MIT License
â”œâ”€â”€ ğŸ“„ .Rbuildignore           Files to exclude from build
â”œâ”€â”€ ğŸ“„ .gitignore              Git ignore patterns
â”‚
â”œâ”€â”€ ğŸ“˜ README.md                Main documentation
â”œâ”€â”€ ğŸ“— SETUP_GUIDE.md          Step-by-step setup instructions
â”œâ”€â”€ ğŸ“™ QUICK_REFERENCE.md      Quick reference guide
â”œâ”€â”€ ğŸ“• PACKAGE_SUMMARY.md      This file
â”‚
â”œâ”€â”€ ğŸ“‚ R/                       R source code
â”‚   â”œâ”€â”€ HiSpaR-package.R           Package-level documentation
â”‚   â”œâ”€â”€ hispa_functions.R          Main R wrapper functions
â”‚   â””â”€â”€ RcppExports.R              Rcpp exports (auto-generated)
â”‚
â”œâ”€â”€ ğŸ“‚ src/                     C++ source code
â”‚   â”œâ”€â”€ Makevars                   Compilation flags (Unix/macOS)
â”‚   â”œâ”€â”€ Makevars.win               Compilation flags (Windows)
â”‚   â””â”€â”€ RcppExports_skeleton.cpp   Template for C++ wrappers
â”‚   
â”‚   ğŸ”¨ TODO: Create hispa_rcpp.cpp (main wrapper)
â”‚   ğŸ”¨ TODO: Copy chromosome.cpp from ../src/
â”‚
â”œâ”€â”€ ğŸ“‚ inst/                    Installed files
â”‚   â””â”€â”€ include/                   Optional: Copy header files here
â”‚   
â”‚   ğŸ”¨ TODO: Optionally copy headers from ../include/
â”‚
â”œâ”€â”€ ğŸ“‚ man/                     Documentation files
â”‚   
â”‚   âš™ï¸  Auto-generated by devtools::document()
â”‚
â”œâ”€â”€ ğŸ“‚ examples/                Example R scripts
â”‚   â”œâ”€â”€ basic_analysis.R           Simple usage example
â”‚   â”œâ”€â”€ with_priors.R              Using prior information
â”‚   â””â”€â”€ convolution_example.R      Contact convolution
â”‚
â”œâ”€â”€ ğŸ“‚ tests/                   Unit tests
â”‚   â”œâ”€â”€ testthat.R                 Test runner
â”‚   â””â”€â”€ testthat/
â”‚       â””â”€â”€ test-hispa.R           Test cases
â”‚
â”œâ”€â”€ ğŸ“‚ vignettes/               Long-form documentation
â”‚   â””â”€â”€ getting-started.Rmd        Tutorial vignette
â”‚
â””â”€â”€ ğŸ“‚ data/                    Example datasets (optional)
    
    ğŸ”¨ TODO: Add example Hi-C contact matrices
```

## ğŸ¯ Main Functions

### 1. `hispa_analyze()`
**Purpose:** Run complete HiSpa MCMC analysis

**Signature:**
```r
hispa_analyze(
  contact_matrix,
  output_dir,
  mcmc_iterations = 6000,
  mcmc_burn_in = 1000,
  num_clusters = 0,
  mcmc_initial_sd = 0.1,
  mcmc_sd_floor = 0.0001,
  mcmc_sd_ceil = 0.3,
  cluster_distance_threshold = 2,
  save_samples = FALSE,
  sample_interval = 50,
  skip_zero_contact_loci = TRUE,
  use_convoluted_sampling = FALSE,
  convolution_half_k = 3,
  verbose = TRUE
)
```

**Returns:** 
- `position_matrix` (n Ã— 3)
- `beta0` (intercept)
- `beta1` (decay parameter)
- `log_likelihood`
- `cluster_labels`

### 2. `hispa_analyze_with_prior()`
**Purpose:** Analysis with gamma priors from prior data

**Signature:**
```r
hispa_analyze_with_prior(
  contact_matrix,
  prior_positions,
  prior_distances,
  output_dir,
  mcmc_iterations = 6000,
  mcmc_burn_in = 1000,
  use_prior_positions = FALSE,
  sample_from_prior = FALSE,
  verbose = TRUE
)
```

**Returns:** Same as above plus `priors` list

### 3. `convolute_contacts()`
**Purpose:** Smooth contact matrix

**Signature:**
```r
convolute_contacts(contact_matrix, half_k = 3)
```

**Returns:** Convoluted matrix

## ğŸ”„ Workflow to Complete Package

### Phase 1: Prepare C++ Code (Required)

1. **Add getter/setter methods to `chromosome.h`:**
   ```cpp
   void set_contact_matrix(const arma::mat& contacts);
   arma::mat get_position_matrix() const;
   double get_beta0() const;
   double get_beta1() const;
   // etc.
   ```

2. **Create `src/hispa_rcpp.cpp`** with Rcpp wrapper functions

3. **Copy implementation:**
   ```bash
   cp ../src/chromosome.cpp src/
   ```

### Phase 2: Build Package

```r
setwd("/Users/lyc/Proj/HiSpa/R-package")

# Generate Rcpp exports
Rcpp::compileAttributes()

# Generate documentation
devtools::document()

# Check for errors
devtools::check()

# Install
devtools::install()
```

### Phase 3: Test

```r
library(HiSpaR)

# Test with small matrix
mat <- matrix(rpois(400, 10), 20, 20)
mat <- (mat + t(mat)) / 2

result <- hispa_analyze(
  contact_matrix = mat,
  output_dir = tempdir(),
  mcmc_iterations = 100
)

print(result)
```

## ğŸ“Š Example Usage

### Basic Analysis
```r
library(HiSpaR)

# Load data
contacts <- as.matrix(read.table("contacts.txt"))

# Run analysis
result <- hispa_analyze(
  contact_matrix = contacts,
  output_dir = "output",
  mcmc_iterations = 6000,
  mcmc_burn_in = 1000,
  verbose = TRUE
)

# Extract results
positions <- result$position_matrix
cat("Beta0:", result$beta0, "Beta1:", result$beta1, "\n")

# Visualize (requires rgl)
library(rgl)
plot3d(positions, col = rainbow(nrow(positions)))
```

### With Prior Information
```r
# Load prior positions
prior_pos <- as.matrix(read.table("prior_positions.txt"))

# Run with priors
result <- hispa_analyze_with_prior(
  contact_matrix = contacts,
  prior_positions = prior_pos,
  prior_distances = c(1, 2, 5, 10),
  output_dir = "output_with_prior"
)

# Check fitted priors
print(result$priors)
```

### Convolution
```r
# Convolute matrix
conv_contacts <- convolute_contacts(contacts, half_k = 3)

# Use in analysis
result <- hispa_analyze(
  contact_matrix = contacts,
  output_dir = "output",
  use_convoluted_sampling = TRUE,
  convolution_half_k = 3
)
```

## ğŸ“š Documentation Structure

### User Documentation
- **README.md** - Installation, quick start, main features
- **Vignette** - `getting-started.Rmd` tutorial
- **Examples** - Three working example scripts
- **Man pages** - Auto-generated from roxygen2 comments

### Developer Documentation
- **SETUP_GUIDE.md** - Detailed setup instructions
- **QUICK_REFERENCE.md** - Quick reference for common tasks
- **PACKAGE_SUMMARY.md** - This overview file
- **Code comments** - Roxygen2 documentation in R files

## ğŸ”§ Key Configuration Files

### DESCRIPTION
Defines package metadata:
- Package name, version, title
- Authors
- Dependencies (Rcpp, RcppArmadillo)
- System requirements (C++17, Armadillo, OpenMP)

### NAMESPACE
Exports functions to users:
- Auto-generated by roxygen2
- Declares C++ library usage

### src/Makevars
Compilation settings:
- C++17 standard
- OpenMP flags
- Armadillo linking
- Platform-specific optimizations

## âœ… What's Complete

- âœ… Package directory structure
- âœ… All metadata files (DESCRIPTION, NAMESPACE, LICENSE)
- âœ… R function interfaces with full documentation
- âœ… Compilation configuration (Makevars)
- âœ… Example scripts (3 different use cases)
- âœ… Unit test framework
- âœ… Vignette template
- âœ… Comprehensive documentation (4 guide files)
- âœ… Print/summary methods for results

## ğŸ”¨ What's Needed

- ğŸ”¨ Create `src/hispa_rcpp.cpp` with Rcpp wrapper functions
- ğŸ”¨ Add getter/setter methods to `Chromosome` class
- ğŸ”¨ Copy `chromosome.cpp` to `src/`
- ğŸ”¨ Run `Rcpp::compileAttributes()` to generate exports
- ğŸ”¨ Run `devtools::document()` to generate man pages
- ğŸ”¨ Build and test the package

## ğŸš€ Quick Start Commands

```bash
# Navigate to package
cd /Users/lyc/Proj/HiSpa/R-package

# In R
R
```

```r
# Install dependencies
install.packages(c("Rcpp", "RcppArmadillo", "devtools", "roxygen2"))

# After creating hispa_rcpp.cpp and copying chromosome.cpp:
library(devtools)
Rcpp::compileAttributes()
document()
check()
install()

# Test
library(HiSpaR)
?hispa_analyze
```

## ğŸ“ Help Resources

- **Setup:** See `SETUP_GUIDE.md`
- **Quick Reference:** See `QUICK_REFERENCE.md`
- **Examples:** See `examples/` directory
- **Rcpp Documentation:** http://www.rcpp.org/
- **R Packages Book:** https://r-pkgs.org/

## ğŸ“ Learning Path

1. **Read SETUP_GUIDE.md** - Understand the setup process
2. **Review hispa_functions.R** - See R interface design
3. **Study examples/** - Understand usage patterns
4. **Check QUICK_REFERENCE.md** - Common tasks reference
5. **Create hispa_rcpp.cpp** - Bridge R and C++
6. **Build and test** - Iterate until working

---

**Next Step:** Follow SETUP_GUIDE.md to complete the C++ integration! ğŸš€
